import{d as Q,i as g,x as T,y as W,c as a,a as L,u as Y,h as Z,w as ee,b as e,t as n,m as C,z as j,k as q,v as K,o as r,F as l,r as B,n as h,g as f,f as u,A as k,p as N,B as te}from"./app-DRuDWrLP.js";import{_ as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-DqJpgNL1.js";import"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-ZkdcgugZ.js";import"./createLucideIcon-CK20d-Ld.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BWMuJWvO.js";import"./useForwardPropsEmits-CEO7KvmN.js";import"./VisuallyHidden-BLrvkZsY.js";import"./index-Cv8D-Bac.js";import"./useForwardExpose-C13p0H4i.js";import"./index-B0R16HDv.js";const re={class:"h-[calc(100vh-0px)] w-full p-4"},oe={class:"grid h-full grid-cols-1 lg:grid-cols-12 gap-4"},de={class:"lg:col-span-3 h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden hidden lg:block"},se={class:"border-b border-gray-200 px-4 py-3 dark:border-gray-800"},ne={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},le={class:"mt-2 flex gap-2"},ie=["onKeydown"],ce={class:"h-[calc(100%-92px)] overflow-y-auto p-2"},ge=["onClick"],ue={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},ye={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},be={key:0,class:"px-3 py-6 text-sm text-gray-500 dark:text-gray-400"},ve={class:"lg:col-span-9 h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden hidden lg:block"},xe={class:"flex items-center justify-between border-b border-gray-200 px-4 py-3 dark:border-gray-800"},he={class:"min-w-0"},fe={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},me={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},ke={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},pe={class:"text-[11px] font-semibold opacity-70 mb-1"},_e={class:"whitespace-pre-wrap"},we={class:"mt-1 text-[10px] opacity-60"},Se={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Te={key:1,class:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400"},Ce={class:"border-t border-gray-200 p-3 dark:border-gray-800"},je={class:"flex items-center gap-3"},qe=["disabled","onKeydown"],Ke=["disabled"],Be={key:0,class:"h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden lg:hidden"},ze={class:"border-b border-gray-200 px-4 py-3 dark:border-gray-800"},Me={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Ve={class:"mt-2 flex gap-2"},Ee=["onKeydown"],Ue={class:"h-[calc(100%-92px)] overflow-y-auto p-2"},Ne=["onClick"],$e={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Ae={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},He={key:0,class:"px-3 py-6 text-sm text-gray-500 dark:text-gray-400"},Ie={key:1,class:"h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden lg:hidden"},De={class:"flex items-center justify-between border-b border-gray-200 px-4 py-3 dark:border-gray-800"},Fe={class:"flex items-center gap-2 min-w-0"},Pe={class:"min-w-0"},Le={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Oe={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},Xe={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Re={class:"text-[11px] font-semibold opacity-70 mb-1"},Ge={class:"whitespace-pre-wrap"},Je={class:"mt-1 text-[10px] opacity-60"},Qe={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},We={key:1,class:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400"},Ye={class:"border-t border-gray-200 p-3 dark:border-gray-800"},Ze={class:"flex items-center gap-3"},et=["disabled","onKeydown"],tt=["disabled"],ut=Q({__name:"Index",props:{channel:{},q:{},students:{},activeStudent:{},activeConversation:{},messages:{}},setup(s){const O=[{title:"Murojaalar",href:"#"}],i=s,X=te(),v=k(()=>X.props.auth?.user?.id),x=g(i.q??""),y=g(""),m=g(!1),c=g([...i.messages]),p=g(null),$=g(!0);function R(o,d=120){return o.scrollHeight-o.scrollTop-o.clientHeight<d}function z(o=!1){requestAnimationFrame(()=>{const d=p.value;d&&(!o&&!$.value||(d.scrollTop=d.scrollHeight))})}function A(){const o=p.value;o&&($.value=R(o))}T(()=>c.value.length,()=>{z(!1)});const M=k(()=>i.channel==="admin"?"/admin/requests":"/psiholog/requests");function H(o){N.get(M.value,{student:o,q:x.value||void 0},{preserveScroll:!0})}function _(){N.get(M.value,{q:x.value||void 0,student:i.activeStudent?.id},{preserveScroll:!0})}function w(){if(!i.activeConversation)return;const o=y.value.trim();o&&(m.value=!0,N.post(`${M.value}/${i.activeConversation.id}/messages`,{body:o},{preserveScroll:!0,onFinish:()=>{m.value=!1,y.value=""}}))}const I=k(()=>!!i.activeConversation&&y.value.trim().length>0&&!m.value),D=k(()=>i.activeStudent?.name??"Talaba");let S=null;const F=g(0);function G(o){window.Echo&&(window.Echo.leave(`conversations.${o}`),S=null)}const b=k(()=>i.activeConversation?.id??null);T(()=>c.value.length,()=>z(!1)),T(()=>i.messages,o=>{const d=new Map;for(const t of c.value)d.set(t.id,t);for(const t of o)d.set(t.id,t);c.value=Array.from(d.values()).sort((t,U)=>t.id-U.id),z(!1)}),W(()=>{b.value&&G(b.value)});let V=null;function P(){b.value&&(!S||typeof S.whisper!="function"||(S.whisper("typing",{role:i.channel}),V&&window.clearTimeout(V),V=window.setTimeout(()=>{},800)))}const E=g(!!b.value);T(b,o=>{o&&(E.value=!0)});function J(){E.value=!1}return(o,d)=>(r(),a(l,null,[L(Y(Z),{title:"Murojaalar"}),L(ae,{breadcrumbs:O},{default:ee(()=>[e("div",re,[e("div",oe,[e("aside",de,[e("div",se,[e("div",ne,n(s.channel==="admin"?"Admin panel":"Psixolog panel"),1),e("div",le,[C(e("input",{"onUpdate:modelValue":d[0]||(d[0]=t=>x.value=t),onKeydown:j(q(_,["prevent"]),["enter"]),class:"h-9 w-full rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Talabani qidiring..."},null,40,ie),[[K,x.value]]),e("button",{class:"h-9 rounded-xl border px-3 text-sm font-semibold border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:_}," OK ")])]),e("div",ce,[(r(!0),a(l,null,B(s.students,t=>(r(),a("button",{key:t.id,class:h(["mb-2 w-full rounded-xl border px-3 py-3 text-left transition border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",s.activeStudent?.id===t.id?"ring-2 ring-offset-2 ring-gray-300 dark:ring-gray-700 dark:ring-offset-gray-950":""]),onClick:U=>H(t.id)},[e("div",ue,n(t.name),1),e("div",ye,n(t.email),1)],10,ge))),128)),s.students.length===0?(r(),a("div",be," Talabalar topilmadi. ")):f("",!0)])]),e("section",ve,[e("div",xe,[e("div",he,[e("div",fe,[s.activeStudent?(r(),a(l,{key:0},[u(n(s.activeStudent.name)+" bilan suhbat ",1)],64)):(r(),a(l,{key:1},[u(" Talaba tanlang ")],64))]),e("div",me,[s.activeStudent?(r(),a(l,{key:0},[u(n(s.activeStudent.email),1)],64)):(r(),a(l,{key:1},[u("Chapdan talabani tanlang")],64))])]),d[4]||(d[4]=e("div",{class:"flex gap-2"},[e("div",{class:"h-8 w-40 rounded-lg border border-gray-200 dark:border-gray-800"}),e("div",{class:"h-8 w-40 rounded-lg border border-gray-200 dark:border-gray-800"})],-1))]),e("div",{ref_key:"messagesEl",ref:p,onScroll:A,class:"h-[calc(100%-120px)] overflow-y-auto p-4"},[s.activeStudent?(r(),a(l,{key:0},[c.value.length===0?(r(),a("div",ke," Hali xabar yo‘q. ")):f("",!0),(r(!0),a(l,null,B(c.value,t=>(r(),a("div",{key:t.id,class:h(["mb-3 flex",t.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:h(["max-w-[70%] rounded-2xl border px-3 py-2 text-sm leading-relaxed",t.sender_id===v.value?"border-gray-200 bg-gray-50 text-gray-900 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100":"border-gray-200 bg-white text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-100"])},[e("div",pe,n(t.sender_id===v.value?"Siz":t.sender_name??"Talaba"),1),e("div",_e,n(t.body),1),e("div",we,n(t.created_at),1)],2)],2))),128)),Date.now()<F.value?(r(),a("div",Se,n(D.value)+" yozayapti... ",1)):f("",!0)],64)):(r(),a("div",Te," Talaba tanlanmagan "))],544),e("div",Ce,[e("div",je,[C(e("input",{"onUpdate:modelValue":d[1]||(d[1]=t=>y.value=t),onInput:P,disabled:!b.value||m.value,onKeydown:j(q(w,["prevent"]),["enter"]),class:"h-11 flex-1 rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Xabar yozing..."},null,40,qe),[[K,y.value]]),e("button",{class:"h-11 rounded-xl border px-4 text-sm font-semibold border-gray-200 hover:bg-gray-50 disabled:opacity-60 dark:border-gray-800 dark:hover:bg-gray-900",disabled:!I.value,onClick:w}," Send ",8,Ke)])])]),E.value?(r(),a("section",Ie,[e("div",De,[e("div",Fe,[e("button",{class:"inline-flex items-center justify-center rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-semibold hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:J}," Back "),e("div",Pe,[e("div",Le,[s.activeStudent?(r(),a(l,{key:0},[u(n(s.activeStudent.name)+" bilan suhbat ",1)],64)):(r(),a(l,{key:1},[u(" Talaba tanlang ")],64))]),e("div",Oe,[s.activeStudent?(r(),a(l,{key:0},[u(n(s.activeStudent.email),1)],64)):(r(),a(l,{key:1},[u("Talaba tanlanmagan")],64))])])])]),e("div",{ref_key:"messagesEl",ref:p,onScroll:A,class:"h-[calc(100%-120px)] overflow-y-auto p-4"},[s.activeStudent?(r(),a(l,{key:0},[c.value.length===0?(r(),a("div",Xe," Hali xabar yo‘q. ")):f("",!0),(r(!0),a(l,null,B(c.value,t=>(r(),a("div",{key:t.id,class:h(["mb-3 flex",t.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:h(["max-w-[85%] rounded-2xl border px-3 py-2 text-sm leading-relaxed",t.sender_id===v.value?"border-gray-200 bg-gray-50 text-gray-900 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100":"border-gray-200 bg-white text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-100"])},[e("div",Re,n(t.sender_id===v.value?"Siz":t.sender_name??"Talaba"),1),e("div",Ge,n(t.body),1),e("div",Je,n(t.created_at),1)],2)],2))),128)),Date.now()<F.value?(r(),a("div",Qe,n(D.value)+" yozayapti... ",1)):f("",!0)],64)):(r(),a("div",We," Talaba tanlanmagan "))],544),e("div",Ye,[e("div",Ze,[C(e("input",{"onUpdate:modelValue":d[3]||(d[3]=t=>y.value=t),onInput:P,disabled:!b.value||m.value,onKeydown:j(q(w,["prevent"]),["enter"]),class:"h-11 flex-1 rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Xabar yozing..."},null,40,et),[[K,y.value]]),e("button",{class:"h-11 rounded-xl border px-4 text-sm font-semibold border-gray-200 hover:bg-gray-50 disabled:opacity-60 dark:border-gray-800 dark:hover:bg-gray-900",disabled:!I.value,onClick:w}," Send ",8,tt)])])])):(r(),a("aside",Be,[e("div",ze,[e("div",Me,n(s.channel==="admin"?"Admin panel":"Psixolog panel"),1),e("div",Ve,[C(e("input",{"onUpdate:modelValue":d[2]||(d[2]=t=>x.value=t),onKeydown:j(q(_,["prevent"]),["enter"]),class:"h-9 w-full rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Talabani qidiring..."},null,40,Ee),[[K,x.value]]),e("button",{class:"h-9 rounded-xl border px-3 text-sm font-semibold border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:_}," OK ")])]),e("div",Ue,[(r(!0),a(l,null,B(s.students,t=>(r(),a("button",{key:t.id,class:h(["mb-2 w-full rounded-xl border px-3 py-3 text-left transition border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",s.activeStudent?.id===t.id?"ring-2 ring-offset-2 ring-gray-300 dark:ring-gray-700 dark:ring-offset-gray-950":""]),onClick:U=>H(t.id)},[e("div",$e,n(t.name),1),e("div",Ae,n(t.email),1)],10,Ne))),128)),s.students.length===0?(r(),a("div",He," Talabalar topilmadi. ")):f("",!0)])]))])])]),_:1})],64))}});export{ut as default};
