import{d as R,i as y,x as j,y as W,c as a,a as I,u as G,h as J,w as Q,b as e,o as s,F as i,r as z,n as c,t as d,g as x,f as b,m as N,z as V,k as F,v as K,A as E,p as T,B as Z}from"./app-DRuDWrLP.js";import{_ as ee}from"./AppStudentLayout.vue_vue_type_script_setup_true_lang-CJYWl1XZ.js";import"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-ZkdcgugZ.js";import"./createLucideIcon-CK20d-Ld.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BWMuJWvO.js";import"./useForwardPropsEmits-CEO7KvmN.js";import"./VisuallyHidden-BLrvkZsY.js";import"./index-Cv8D-Bac.js";import"./useForwardExpose-C13p0H4i.js";import"./index-B0R16HDv.js";const te={class:"h-[calc(100vh-0px)] w-full p-4"},re={class:"grid h-full grid-cols-1 lg:grid-cols-12 gap-4"},ae={class:"lg:col-span-3 h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden hidden lg:block"},se={class:"p-3 flex gap-2"},oe={class:"h-[calc(100%-110px)] overflow-y-auto px-2 pb-3"},de=["onClick"],ne={class:"flex items-center justify-between gap-2"},ie={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},le={class:"mt-1 text-xs text-gray-600 dark:text-gray-400 line-clamp-2"},ge={class:"mt-2 text-[11px] text-gray-500 dark:text-gray-500"},ue={key:0,class:"px-3 py-6 text-sm text-gray-500 dark:text-gray-400"},ye={class:"lg:col-span-9 h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden hidden lg:block"},ce={class:"flex items-center justify-between border-b border-gray-200 px-4 py-3 dark:border-gray-800"},be={class:"min-w-0"},ve={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},xe={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},he={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},fe={class:"text-[11px] font-semibold opacity-70 mb-1"},me={class:"whitespace-pre-wrap"},pe={class:"mt-1 text-[10px] opacity-60"},ke={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},_e={key:1,class:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400"},we={class:"border-t border-gray-200 p-3 dark:border-gray-800"},Ce={class:"flex items-center gap-3"},je=["disabled","onKeydown"],ze=["disabled"],Se={key:0,class:"h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden lg:hidden"},qe={class:"p-3 flex gap-2"},Me={class:"h-[calc(100%-110px)] overflow-y-auto px-2 pb-3"},Be=["onClick"],Ee={class:"flex items-center justify-between gap-2"},Te={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},$e={class:"mt-1 text-xs text-gray-600 dark:text-gray-400 line-clamp-2"},Ae={class:"mt-2 text-[11px] text-gray-500 dark:text-gray-500"},De={key:0,class:"px-3 py-6 text-sm text-gray-500 dark:text-gray-400"},He={key:1,class:"h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden lg:hidden"},Pe={class:"flex items-center justify-between border-b border-gray-200 px-4 py-3 dark:border-gray-800"},Ie={class:"flex items-center gap-2 min-w-0"},Ne={class:"min-w-0"},Ve={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Fe={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},Ke={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Oe={class:"text-[11px] font-semibold opacity-70 mb-1"},Ue={class:"whitespace-pre-wrap"},Le={class:"mt-1 text-[10px] opacity-60"},Xe={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Ye={key:1,class:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400"},Re={class:"border-t border-gray-200 p-3 dark:border-gray-800"},We={class:"flex items-center gap-3"},Ge=["disabled","onKeydown"],Je=["disabled"],it=R({__name:"Index",props:{conversations:{},activeConversation:{},messages:{}},setup(n){const h=n,l=y([...h.messages]),p=y(null),k=y(!0);function O(o,r=120){return o.scrollHeight-o.scrollTop-o.clientHeight<r}function S(o=!1){requestAnimationFrame(()=>{const r=p.value;r&&(!o&&!k.value||(r.scrollTop=r.scrollHeight))})}function $(){const o=p.value;o&&(k.value=O(o))}const U=Z(),v=E(()=>U.props.auth?.user?.id),u=y(""),f=y(!1),g=E(()=>h.activeConversation?.id??null);function A(o){T.get("/student/requests",{conversation:o},{preserveScroll:!0})}function _(o){T.post("/student/requests",{channel:o},{preserveScroll:!0})}async function w(){if(!g.value)return;const o=u.value.trim();if(!o)return;const r=Date.now()*-1;l.value.push({id:r,sender_role:"student",sender_id:v.value,sender_name:"Siz",body:o,created_at:new Date().toISOString()}),u.value="",f.value=!0,T.post(`/student/requests/${g.value}/messages`,{body:o},{preserveScroll:!0,onFinish:()=>{f.value=!1},onSuccess:()=>{l.value=[...h.messages]},onError:()=>{l.value=l.value.filter(t=>t.id!==r)}})}let C=null;function L(o){window.Echo&&(C=window.Echo.private(`conversations.${o}`).listen(".App\\Events\\MessageCreated",r=>console.log("got",r)).listen(".message.created",r=>{console.log(r),l.value.some(t=>t.id===r.id)||l.value.push(r)}).listenForWhisper("typing",r=>{console.log(r),m.value=r?.name??"",q.value=Date.now()+1500}))}function D(o){window.Echo&&(window.Echo.leave(`conversations.${o}`),C=null)}const m=y(""),q=y(0);j(()=>h.messages,o=>{l.value=[...o],k.value=!0,S(!0)},{immediate:!0}),j(()=>l.value.length,()=>{S(!1)}),W(()=>{g.value&&D(g.value)});const H=E(()=>!!g.value&&u.value.trim().length>0&&!f.value);let M=null;function P(){!g.value||!C||(C.whisper("typing",{name:"Siz yozayapsiz..."}),M&&window.clearTimeout(M),M=window.setTimeout(()=>{},800))}j(g,(o,r)=>{r&&D(r),o&&L(o),l.value=[...h.messages],u.value="",k.value=!0,S(!0)});const B=y(!!g.value);j(g,o=>{o&&(B.value=!0)});function X(){B.value=!1}return(o,r)=>(s(),a(i,null,[I(G(J),{title:"Murojaatlar"}),I(ee,null,{default:Q(()=>[e("div",te,[e("div",re,[e("aside",ae,[r[6]||(r[6]=e("div",{class:"border-b border-gray-200 px-4 py-3 dark:border-gray-800"},[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"Murojaatlar")],-1)),e("div",se,[e("button",{class:"w-full rounded-xl border px-3 py-2 text-xs font-medium border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:r[0]||(r[0]=t=>_("admin"))}," Admin bilan suhbat "),e("button",{class:"w-full rounded-xl border px-3 py-2 text-xs font-medium border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:r[1]||(r[1]=t=>_("psiholog"))}," Psiholog bilan suhbat ")]),e("div",oe,[(s(!0),a(i,null,z(n.conversations,t=>(s(),a("button",{key:t.id,class:c(["mb-2 w-full rounded-xl border px-3 py-3 text-left transition border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",g.value===t.id?"ring-2 ring-offset-2 ring-gray-300 dark:ring-gray-700 dark:ring-offset-gray-950":""]),onClick:Y=>A(t.id)},[e("div",ne,[e("div",ie,d(t.channel==="admin"?"Admin":"Psiholog"),1),e("span",{class:c(["rounded-full px-2 py-0.5 text-[10px] font-semibold",t.status==="open"?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200":"bg-gray-100 text-gray-700 dark:bg-gray-900 dark:text-gray-200"])},d(t.status),3)]),e("div",le,d(t.subject??"Mavzu: (yo‘q)"),1),e("div",ge," Oxirgi: "+d(t.last_message_at??t.created_at),1)],10,de))),128)),n.conversations.length===0?(s(),a("div",ue," Hali murojaat yo‘q. Yuqoridan suhbat boshlang. ")):x("",!0)])]),e("section",ye,[e("div",ce,[e("div",be,[e("div",ve,[n.activeConversation?(s(),a(i,{key:0},[b(d(n.activeConversation.channel==="admin"?"Admin bilan chat":"Psiholog bilan chat"),1)],64)):(s(),a(i,{key:1},[b(" Chat tanlang ")],64))]),e("div",xe,[n.activeConversation?(s(),a(i,{key:0},[b(d(n.activeConversation.subject??"Mavzu: (yo‘q)"),1)],64)):(s(),a(i,{key:1},[b(" Chapdan murojaat tanlang yoki yangisini yarating ")],64))])]),r[7]||(r[7]=e("div",{class:"flex gap-2"},[e("div",{class:"h-8 w-40 rounded-lg border border-gray-200 dark:border-gray-800"}),e("div",{class:"h-8 w-40 rounded-lg border border-gray-200 dark:border-gray-800"})],-1))]),e("div",{ref_key:"messagesEl",ref:p,onScroll:$,class:"h-[calc(100%-120px)] overflow-y-auto p-4"},[n.activeConversation?(s(),a(i,{key:0},[l.value.length===0?(s(),a("div",he," Hali xabar yo‘q. Birinchi bo‘lib yozing. ")):x("",!0),(s(!0),a(i,null,z(l.value,t=>(s(),a("div",{key:t.id,class:c(["mb-3 flex",t.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:c(["max-w-[70%] rounded-2xl border px-3 py-2 text-sm leading-relaxed",t.sender_id===v.value?"border-gray-200 bg-gray-50 text-gray-900 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100":"border-gray-200 bg-white text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-100"])},[e("div",fe,d(t.sender_id===v.value?"Siz":t.sender_name??"Operator"),1),e("div",me,d(t.body),1),e("div",pe,d(t.created_at),1)],2)],2))),128)),m.value&&Date.now()<q.value?(s(),a("div",ke,d(m.value)+" yozayapti... ",1)):x("",!0)],64)):(s(),a("div",_e," Chat tanlanmagan "))],544),e("div",we,[e("div",Ce,[N(e("input",{"onUpdate:modelValue":r[2]||(r[2]=t=>u.value=t),onInput:P,disabled:!g.value||f.value,onKeydown:V(F(w,["prevent"]),["enter"]),class:"h-11 flex-1 rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Xabar yozing..."},null,40,je),[[K,u.value]]),e("button",{class:"h-11 rounded-xl border px-4 text-sm font-semibold border-gray-200 hover:bg-gray-50 disabled:opacity-60 dark:border-gray-800 dark:hover:bg-gray-900",disabled:!H.value,onClick:w}," Send ",8,ze)])])]),B.value?(s(),a("section",He,[e("div",Pe,[e("div",Ie,[e("button",{class:"inline-flex items-center justify-center rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-semibold hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:X}," Back "),e("div",Ne,[e("div",Ve,[n.activeConversation?(s(),a(i,{key:0},[b(d(n.activeConversation.channel==="admin"?"Admin bilan chat":"Psiholog bilan chat"),1)],64)):(s(),a(i,{key:1},[b("Chat tanlang")],64))]),e("div",Fe,[n.activeConversation?(s(),a(i,{key:0},[b(d(n.activeConversation.subject??"Mavzu: (yo‘q)"),1)],64)):(s(),a(i,{key:1},[b("Chat tanlanmagan")],64))])])])]),e("div",{ref_key:"messagesEl",ref:p,onScroll:$,class:"h-[calc(100%-120px)] overflow-y-auto p-4"},[n.activeConversation?(s(),a(i,{key:0},[l.value.length===0?(s(),a("div",Ke," Hali xabar yo‘q. Birinchi bo‘lib yozing. ")):x("",!0),(s(!0),a(i,null,z(l.value,t=>(s(),a("div",{key:t.id,class:c(["mb-3 flex",t.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:c(["max-w-[85%] rounded-2xl border px-3 py-2 text-sm leading-relaxed",t.sender_id===v.value?"border-gray-200 bg-gray-50 text-gray-900 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100":"border-gray-200 bg-white text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-100"])},[e("div",Oe,d(t.sender_id===v.value?"Siz":t.sender_name??"Operator"),1),e("div",Ue,d(t.body),1),e("div",Le,d(t.created_at),1)],2)],2))),128)),m.value&&Date.now()<q.value?(s(),a("div",Xe,d(m.value)+" yozayapti... ",1)):x("",!0)],64)):(s(),a("div",Ye," Chat tanlanmagan "))],544),e("div",Re,[e("div",We,[N(e("input",{"onUpdate:modelValue":r[5]||(r[5]=t=>u.value=t),onInput:P,disabled:!g.value||f.value,onKeydown:V(F(w,["prevent"]),["enter"]),class:"h-11 flex-1 rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Xabar yozing..."},null,40,Ge),[[K,u.value]]),e("button",{class:"h-11 rounded-xl border px-4 text-sm font-semibold border-gray-200 hover:bg-gray-50 disabled:opacity-60 dark:border-gray-800 dark:hover:bg-gray-900",disabled:!H.value,onClick:w}," Send ",8,Je)])])])):(s(),a("aside",Se,[r[8]||(r[8]=e("div",{class:"border-b border-gray-200 px-4 py-3 dark:border-gray-800"},[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"Murojaatlar")],-1)),e("div",qe,[e("button",{class:"w-full rounded-xl border px-3 py-2 text-xs font-medium border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:r[3]||(r[3]=t=>_("admin"))}," Admin bilan suhbat "),e("button",{class:"w-full rounded-xl border px-3 py-2 text-xs font-medium border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:r[4]||(r[4]=t=>_("psiholog"))}," Psiholog bilan suhbat ")]),e("div",Me,[(s(!0),a(i,null,z(n.conversations,t=>(s(),a("button",{key:t.id,class:c(["mb-2 w-full rounded-xl border px-3 py-3 text-left transition border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",g.value===t.id?"ring-2 ring-offset-2 ring-gray-300 dark:ring-gray-700 dark:ring-offset-gray-950":""]),onClick:Y=>A(t.id)},[e("div",Ee,[e("div",Te,d(t.channel==="admin"?"Admin":"Psiholog"),1),e("span",{class:c(["rounded-full px-2 py-0.5 text-[10px] font-semibold",t.status==="open"?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200":"bg-gray-100 text-gray-700 dark:bg-gray-900 dark:text-gray-200"])},d(t.status),3)]),e("div",$e,d(t.subject??"Mavzu: (yo‘q)"),1),e("div",Ae," Oxirgi: "+d(t.last_message_at??t.created_at),1)],10,Be))),128)),n.conversations.length===0?(s(),a("div",De," Hali murojaat yo‘q. Yuqoridan suhbat boshlang. ")):x("",!0)])]))])])]),_:1})],64))}});export{it as default};
