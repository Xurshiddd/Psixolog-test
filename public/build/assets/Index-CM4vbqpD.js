import{d as ee,i as g,x as j,y as te,c as s,a as R,u as ae,h as re,w as se,b as e,t as n,m as q,z as E,k as K,v as B,o,F as i,r as M,n as f,g as h,f as y,A as m,B as W,p as $,C as oe}from"./app-C61dhLsN.js";import{_ as de}from"./AppLayout.vue_vue_type_script_setup_true_lang-BrE9Isxh.js";import"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-DNy_pLtE.js";import"./createLucideIcon-VWjf9L-B.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dvo79KTy.js";import"./useForwardPropsEmits-B2701Qq5.js";import"./VisuallyHidden-CTKZ6sMw.js";import"./index-jhviVBWZ.js";import"./useForwardExpose-DBRpqD69.js";import"./index-B0R16HDv.js";const ne={class:"h-[calc(100vh-0px)] w-full p-4"},ie={class:"grid h-full grid-cols-1 lg:grid-cols-12 gap-4"},le={class:"lg:col-span-3 h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden hidden lg:block"},ce={class:"border-b border-gray-200 px-4 py-3 dark:border-gray-800"},ge={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},ue={class:"mt-2 flex gap-2"},ye=["onKeydown"],be={class:"h-[calc(100%-92px)] overflow-y-auto p-2"},ve=["onClick"],xe={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},fe={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},he={key:0,class:"px-3 py-6 text-sm text-gray-500 dark:text-gray-400"},me={class:"lg:col-span-9 h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden hidden lg:flex lg:flex-col"},ke={class:"flex items-center justify-between border-b border-gray-200 px-4 py-3 dark:border-gray-800"},pe={class:"min-w-0"},_e={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},we={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},Se={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Te={class:"text-[11px] font-semibold opacity-70 mb-1"},Ce={class:"whitespace-pre-wrap"},je={class:"mt-1 text-[10px] opacity-60"},qe={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Ee={key:1,class:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400"},Ke={class:"border-t border-gray-200 p-3 dark:border-gray-800"},Be={class:"flex items-center gap-3"},Me=["disabled","onKeydown"],ze=["disabled"],Ve={key:0,class:"h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden lg:hidden"},De={class:"border-b border-gray-200 px-4 py-3 dark:border-gray-800"},Ue={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},$e={class:"mt-2 flex gap-2"},Ae=["onKeydown"],Ne={class:"h-[calc(100%-92px)] overflow-y-auto p-2"},Fe=["onClick"],He={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Pe={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},Ie={key:0,class:"px-3 py-6 text-sm text-gray-500 dark:text-gray-400"},Le={key:1,class:"h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden lg:hidden flex flex-col"},Oe={class:"shrink-0 flex items-center justify-between border-b border-gray-200 px-4 py-3 dark:border-gray-800"},Xe={class:"flex items-center gap-2 min-w-0"},Re={class:"min-w-0"},We={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Ge={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},Je={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Qe={class:"text-[11px] font-semibold opacity-70 mb-1"},Ye={class:"whitespace-pre-wrap"},Ze={class:"mt-1 text-[10px] opacity-60"},et={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},tt={key:1,class:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400"},at={class:"shrink-0 border-t border-gray-200 p-3 dark:border-gray-800"},rt={class:"flex items-center gap-3"},st=["disabled","onKeydown"],ot=["disabled"],xt=ee({__name:"Index",props:{channel:{},q:{},students:{},activeStudent:{},activeConversation:{},messages:{}},setup(d){const G=[{title:"Murojaalar",href:"#"}],l=d,J=oe(),v=m(()=>J.props.auth?.user?.id),x=g(l.q??""),u=g(""),k=g(!1),c=g([...l.messages]),w=g(!0),A=g(null),N=g(null),F=m(()=>{const a=A.value,r=N.value;return r&&r.offsetParent!==null?r:a&&a.offsetParent!==null?a:r??a??null});function Q(a,r=120){return a.scrollHeight-a.scrollTop-a.clientHeight<r}async function p(a=!1){await W(),await W(),requestAnimationFrame(()=>{const r=F.value;r&&(!a&&!w.value||(r.scrollTop=r.scrollHeight))})}function H(){const a=F.value;a&&(w.value=Q(a))}const z=m(()=>l.channel==="admin"?"/admin/requests":"/psiholog/requests");function P(a){$.get(z.value,{student:a,q:x.value||void 0},{preserveScroll:!0,preserveState:!1})}function S(){$.get(z.value,{q:x.value||void 0,student:l.activeStudent?.id},{preserveScroll:!0,preserveState:!1})}function T(){if(!l.activeConversation)return;const a=u.value.trim();a&&(k.value=!0,$.post(`${z.value}/${l.activeConversation.id}/messages`,{body:a},{preserveScroll:!0,onFinish:()=>{k.value=!1,u.value=""}}))}const I=m(()=>!!l.activeConversation&&u.value.trim().length>0&&!k.value),L=m(()=>l.activeStudent?.name??"Talaba");let _=null;const V=g(0);function Y(a){window.Echo&&(_=window.Echo.private(`conversations.${a}`).listen(".message.created",async r=>{c.value.some(t=>t.id===r.id)||(c.value.push(r),await p(!1))}).listenForWhisper("typing",()=>{V.value=Date.now()+1500}))}function O(a){window.Echo&&(window.Echo.leave(`conversations.${a}`),_=null)}const b=m(()=>l.activeConversation?.id??null);j(()=>l.messages,async a=>{const r=new Map;for(const t of c.value)r.set(t.id,t);for(const t of a)r.set(t.id,t);c.value=Array.from(r.values()).sort((t,U)=>t.id-U.id),w.value=!0,await p(!0)},{immediate:!0}),j(()=>c.value.length,()=>{p(!1)});const C=g(!!b.value);j(C,async a=>{a&&await p(!0)}),j(b,async(a,r)=>{r&&O(r),a&&Y(a),C.value=!!a,u.value="",w.value=!0,await p(!0)},{immediate:!0}),te(()=>{b.value&&O(b.value)});let D=null;function X(){b.value&&(!_||typeof _.whisper!="function"||(_.whisper("typing",{role:l.channel}),D&&window.clearTimeout(D),D=window.setTimeout(()=>{},800)))}function Z(){C.value=!1}return(a,r)=>(o(),s(i,null,[R(ae(re),{title:"Murojaalar"}),R(de,{breadcrumbs:G},{default:se(()=>[e("div",ne,[e("div",ie,[e("aside",le,[e("div",ce,[e("div",ge,n(d.channel==="admin"?"Admin panel":"Psixolog panel"),1),e("div",ue,[q(e("input",{"onUpdate:modelValue":r[0]||(r[0]=t=>x.value=t),onKeydown:E(K(S,["prevent"]),["enter"]),class:"h-9 w-full rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Talabani qidiring..."},null,40,ye),[[B,x.value]]),e("button",{class:"h-9 rounded-xl border px-3 text-sm font-semibold border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:S}," OK ")])]),e("div",be,[(o(!0),s(i,null,M(d.students,t=>(o(),s("button",{key:t.id,class:f(["mb-2 w-full rounded-xl border px-3 py-3 text-left transition border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",d.activeStudent?.id===t.id?"ring-2 ring-offset-2 ring-gray-300 dark:ring-gray-700 dark:ring-offset-gray-950":""]),onClick:U=>P(t.id)},[e("div",xe,n(t.name),1),e("div",fe,n(t.email),1)],10,ve))),128)),d.students.length===0?(o(),s("div",he," Talabalar topilmadi. ")):h("",!0)])]),e("section",me,[e("div",ke,[e("div",pe,[e("div",_e,[d.activeStudent?(o(),s(i,{key:0},[y(n(d.activeStudent.name)+" bilan suhbat ",1)],64)):(o(),s(i,{key:1},[y(" Talaba tanlang ")],64))]),e("div",we,[d.activeStudent?(o(),s(i,{key:0},[y(n(d.activeStudent.email),1)],64)):(o(),s(i,{key:1},[y("Chapdan talabani tanlang")],64))])]),r[4]||(r[4]=e("div",{class:"flex gap-2"},[e("div",{class:"h-8 w-40 rounded-lg border border-gray-200 dark:border-gray-800"}),e("div",{class:"h-8 w-40 rounded-lg border border-gray-200 dark:border-gray-800"})],-1))]),e("div",{ref_key:"messagesElDesktop",ref:A,onScroll:H,class:"flex-1 min-h-0 overflow-y-auto p-4"},[d.activeStudent?(o(),s(i,{key:0},[c.value.length===0?(o(),s("div",Se," Hali xabar yo‘q. ")):h("",!0),(o(!0),s(i,null,M(c.value,t=>(o(),s("div",{key:t.id,class:f(["mb-3 flex",t.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:f(["max-w-[70%] rounded-2xl border px-3 py-2 text-sm leading-relaxed",t.sender_id===v.value?"border-gray-200 bg-gray-50 text-gray-900 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100":"border-gray-200 bg-white text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-100"])},[e("div",Te,n(t.sender_id===v.value?"Siz":t.sender_name??"Talaba"),1),e("div",Ce,n(t.body),1),e("div",je,n(t.created_at),1)],2)],2))),128)),Date.now()<V.value?(o(),s("div",qe,n(L.value)+" yozayapti... ",1)):h("",!0)],64)):(o(),s("div",Ee," Talaba tanlanmagan "))],544),e("div",Ke,[e("div",Be,[q(e("input",{"onUpdate:modelValue":r[1]||(r[1]=t=>u.value=t),onInput:X,disabled:!b.value||k.value,onKeydown:E(K(T,["prevent"]),["enter"]),class:"h-11 flex-1 rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Xabar yozing..."},null,40,Me),[[B,u.value]]),e("button",{class:"h-11 rounded-xl border px-4 text-sm font-semibold border-gray-200 hover:bg-gray-50 disabled:opacity-60 dark:border-gray-800 dark:hover:bg-gray-900",disabled:!I.value,onClick:T}," Send ",8,ze)])])]),C.value?(o(),s("section",Le,[e("div",Oe,[e("div",Xe,[e("button",{class:"inline-flex items-center justify-center rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-semibold hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:Z}," Back "),e("div",Re,[e("div",We,[d.activeStudent?(o(),s(i,{key:0},[y(n(d.activeStudent.name)+" bilan suhbat ",1)],64)):(o(),s(i,{key:1},[y(" Talaba tanlang ")],64))]),e("div",Ge,[d.activeStudent?(o(),s(i,{key:0},[y(n(d.activeStudent.email),1)],64)):(o(),s(i,{key:1},[y("Talaba tanlanmagan")],64))])])])]),e("div",{ref_key:"messagesElMobile",ref:N,onScroll:H,class:"flex-1 min-h-0 overflow-y-auto p-4"},[d.activeStudent?(o(),s(i,{key:0},[c.value.length===0?(o(),s("div",Je," Hali xabar yo‘q. ")):h("",!0),(o(!0),s(i,null,M(c.value,t=>(o(),s("div",{key:t.id,class:f(["mb-3 flex",t.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:f(["max-w-[85%] rounded-2xl border px-3 py-2 text-sm leading-relaxed",t.sender_id===v.value?"border-gray-200 bg-gray-50 text-gray-900 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100":"border-gray-200 bg-white text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-100"])},[e("div",Qe,n(t.sender_id===v.value?"Siz":t.sender_name??"Talaba"),1),e("div",Ye,n(t.body),1),e("div",Ze,n(t.created_at),1)],2)],2))),128)),Date.now()<V.value?(o(),s("div",et,n(L.value)+" yozayapti... ",1)):h("",!0)],64)):(o(),s("div",tt," Talaba tanlanmagan "))],544),e("div",at,[e("div",rt,[q(e("input",{"onUpdate:modelValue":r[3]||(r[3]=t=>u.value=t),onInput:X,disabled:!b.value||k.value,onKeydown:E(K(T,["prevent"]),["enter"]),class:"shrink-0 h-11 flex-1 rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Xabar yozing..."},null,40,st),[[B,u.value]]),e("button",{class:"h-11 rounded-xl border px-4 text-sm font-semibold border-gray-200 hover:bg-gray-50 disabled:opacity-60 dark:border-gray-800 dark:hover:bg-gray-900",disabled:!I.value,onClick:T}," Send ",8,ot)])])])):(o(),s("aside",Ve,[e("div",De,[e("div",Ue,n(d.channel==="admin"?"Admin panel":"Psixolog panel"),1),e("div",$e,[q(e("input",{"onUpdate:modelValue":r[2]||(r[2]=t=>x.value=t),onKeydown:E(K(S,["prevent"]),["enter"]),class:"h-9 w-full rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Talabani qidiring..."},null,40,Ae),[[B,x.value]]),e("button",{class:"h-9 rounded-xl border px-3 text-sm font-semibold border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:S}," OK ")])]),e("div",Ne,[(o(!0),s(i,null,M(d.students,t=>(o(),s("button",{key:t.id,class:f(["mb-2 w-full rounded-xl border px-3 py-3 text-left transition border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",d.activeStudent?.id===t.id?"ring-2 ring-offset-2 ring-gray-300 dark:ring-gray-700 dark:ring-offset-gray-950":""]),onClick:U=>P(t.id)},[e("div",He,n(t.name),1),e("div",Pe,n(t.email),1)],10,Fe))),128)),d.students.length===0?(o(),s("div",Ie," Talabalar topilmadi. ")):h("",!0)])]))])])]),_:1})],64))}});export{xt as default};
