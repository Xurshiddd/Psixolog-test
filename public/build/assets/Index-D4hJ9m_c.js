import{d as W,r as u,B as k,J as Q,c as s,a as N,u as Z,h as ee,w as te,b as e,o,F as i,f as z,n as y,t as n,k as x,i as b,e as V,K as F,q as O,v as U,D as L,G as q,m as E,L as ae}from"./app-DOhVdoN8.js";import{_ as re}from"./AppStudentLayout.vue_vue_type_script_setup_true_lang-MNa_SnsT.js";import"./AppSidebarHeader.vue_vue_type_script_setup_true_lang-BouGe3Q8.js";import"./createLucideIcon-B-BGo4CG.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DF8t7Vlr.js";import"./useForwardPropsEmits-BCF2wzBt.js";import"./VisuallyHidden-CeZakV8k.js";import"./index-BbqGKNiK.js";import"./useForwardExpose-DyqayvAp.js";import"./index-8hKDQZPy.js";const se={class:"h-[calc(100vh-0px)] w-full p-4"},oe={class:"grid h-full grid-cols-1 lg:grid-cols-12 gap-4"},ne={class:"lg:col-span-3 h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden hidden lg:block"},de={class:"p-3 flex gap-2"},ie={class:"h-[calc(100%-110px)] overflow-y-auto px-2 pb-3"},le=["onClick"],ge={class:"flex items-center justify-between gap-2"},ue={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},ce={class:"mt-1 text-xs text-gray-600 dark:text-gray-400 line-clamp-2"},ye={class:"mt-2 text-[11px] text-gray-500 dark:text-gray-500"},be={key:0,class:"px-3 py-6 text-sm text-gray-500 dark:text-gray-400"},ve={class:"lg:col-span-9 h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden hidden lg:block"},xe={class:"flex items-center justify-between border-b border-gray-200 px-4 py-3 dark:border-gray-800"},he={class:"min-w-0"},fe={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},me={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},ke={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},pe={class:"text-[11px] font-semibold opacity-70 mb-1"},_e={class:"whitespace-pre-wrap"},we={class:"mt-1 text-[10px] opacity-60"},Ce={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},je={key:1,class:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400"},Se={class:"border-t border-gray-200 p-3 dark:border-gray-800"},ze={class:"flex items-center gap-3"},qe=["disabled","onKeydown"],Me=["disabled"],Be={key:0,class:"h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden lg:hidden"},Ee={class:"p-3 flex gap-2"},Te={class:"h-[calc(100%-110px)] overflow-y-auto px-2 pb-3"},De=["onClick"],$e={class:"flex items-center justify-between gap-2"},Pe={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Ae={class:"mt-1 text-xs text-gray-600 dark:text-gray-400 line-clamp-2"},He={class:"mt-2 text-[11px] text-gray-500 dark:text-gray-500"},Ie={key:0,class:"px-3 py-6 text-sm text-gray-500 dark:text-gray-400"},Ke={key:1,class:"h-full rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950 overflow-hidden lg:hidden"},Ne={class:"flex items-center justify-between border-b border-gray-200 px-4 py-3 dark:border-gray-800"},Ve={class:"flex items-center gap-2 min-w-0"},Fe={class:"min-w-0"},Oe={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},Ue={class:"text-xs text-gray-600 dark:text-gray-400 truncate"},Le={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Xe={class:"text-[11px] font-semibold opacity-70 mb-1"},Ye={class:"whitespace-pre-wrap"},Ge={class:"mt-1 text-[10px] opacity-60"},Je={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Re={key:1,class:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400"},We={class:"border-t border-gray-200 p-3 dark:border-gray-800"},Qe={class:"flex items-center gap-3"},Ze=["disabled","onKeydown"],et=["disabled"],ut=W({__name:"Index",props:{conversations:{},activeConversation:{},messages:{}},setup(d){const p=d,l=u([...p.messages]),_=u(!0),T=u(null),D=u(null),$=q(()=>{const r=T.value,a=D.value;return a&&a.offsetParent!==null?a:r&&r.offsetParent!==null?r:a??r??null});function X(r,a=120){return r.scrollHeight-r.scrollTop-r.clientHeight<a}async function h(r=!1){await L(),await L(),requestAnimationFrame(()=>{const a=$.value;a&&(!r&&!_.value||(a.scrollTop=a.scrollHeight))})}function P(){const r=$.value;r&&(_.value=X(r))}const Y=ae(),v=q(()=>Y.props.auth?.user?.id),c=u(""),f=u(!1),g=q(()=>p.activeConversation?.id??null);k(()=>l.value.length,()=>{h(!1)});function A(r){E.get("/student/requests",{conversation:r},{preserveScroll:!0,preserveState:!1})}function w(r){p.conversations.find(a=>a.channel===r)||E.post("/student/requests",{channel:r},{preserveScroll:!0})}async function C(){if(!g.value)return;const r=c.value.trim();if(!r)return;const a=Date.now()*-1;l.value.push({id:a,sender_role:"student",sender_id:v.value,sender_name:"Siz",body:r,created_at:new Date().toISOString()}),c.value="",f.value=!0,E.post(`/student/requests/${g.value}/messages`,{body:r},{preserveScroll:!0,onFinish:()=>{f.value=!1},onError:()=>{l.value=l.value.filter(t=>t.id!==a)}})}let j=null;function G(r){window.Echo&&(j=window.Echo.private(`conversations.${r}`).listen(".message.created",a=>{l.value.some(t=>t.id===a.id)||l.value.push(a)}).listenForWhisper("typing",a=>{m.value=a?.name??"",M.value=Date.now()+1500}))}function H(r){window.Echo&&(window.Echo.leave(`conversations.${r}`),j=null)}const m=u(""),M=u(0),I=q(()=>!!g.value&&c.value.trim().length>0&&!f.value);let B=null;function K(){!g.value||!j||(j.whisper("typing",{name:"Siz yozayapsiz..."}),B&&window.clearTimeout(B),B=window.setTimeout(()=>{},800))}k(()=>p.messages,async r=>{l.value=[...r],_.value=!0,await h(!0)},{immediate:!0}),k(()=>l.value.length,async()=>{await h(!1)});const S=u(!!g.value);k(g,async(r,a)=>{a&&H(a),r&&G(r),S.value=!!r,c.value="",_.value=!0,await h(!0)},{immediate:!0});function J(){S.value=!1}return Q(()=>{g.value&&H(g.value)}),k(S,async r=>{r&&await h(!0)}),(r,a)=>(o(),s(i,null,[N(Z(ee),{title:"Murojaatlar"}),N(re,null,{default:te(()=>[e("div",se,[e("div",oe,[e("aside",ne,[a[6]||(a[6]=e("div",{class:"border-b border-gray-200 px-4 py-3 dark:border-gray-800"},[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"Murojaatlar")],-1)),e("div",de,[e("button",{class:"w-full rounded-xl border px-3 py-2 text-xs font-medium border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:a[0]||(a[0]=t=>w("admin"))}," Admin bilan suhbat "),e("button",{class:"w-full rounded-xl border px-3 py-2 text-xs font-medium border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:a[1]||(a[1]=t=>w("psiholog"))}," Psixolog bilan suhbat ")]),e("div",ie,[(o(!0),s(i,null,z(d.conversations,t=>(o(),s("button",{key:t.id,class:y(["mb-2 w-full rounded-xl border px-3 py-3 text-left transition border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",g.value===t.id?"ring-2 ring-offset-2 ring-gray-300 dark:ring-gray-700 dark:ring-offset-gray-950":""]),onClick:R=>A(t.id)},[e("div",ge,[e("div",ue,n(t.channel==="admin"?"Admin":"Psixolog"),1),e("span",{class:y(["rounded-full px-2 py-0.5 text-[10px] font-semibold",t.status==="open"?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200":"bg-gray-100 text-gray-700 dark:bg-gray-900 dark:text-gray-200"])},n(t.status),3)]),e("div",ce,n(t.subject??"Mavzu: (yo‘q)"),1),e("div",ye," Oxirgi: "+n(t.last_message_at??t.created_at),1)],10,le))),128)),d.conversations.length===0?(o(),s("div",be," Hali murojaat yo‘q. Yuqoridan suhbat boshlang. ")):x("",!0)])]),e("section",ve,[e("div",xe,[e("div",he,[e("div",fe,[d.activeConversation?(o(),s(i,{key:0},[b(n(d.activeConversation.channel==="admin"?"Admin bilan chat":"Psixolog bilan chat"),1)],64)):(o(),s(i,{key:1},[b(" Chat tanlang ")],64))]),e("div",me,[d.activeConversation?(o(),s(i,{key:0},[b(n(d.activeConversation.subject??"Mavzu: (yo‘q)"),1)],64)):(o(),s(i,{key:1},[b(" Chapdan murojaat tanlang yoki yangisini yarating ")],64))])]),a[7]||(a[7]=e("div",{class:"flex gap-2"},[e("div",{class:"h-8 w-40 rounded-lg border border-gray-200 dark:border-gray-800"}),e("div",{class:"h-8 w-40 rounded-lg border border-gray-200 dark:border-gray-800"})],-1))]),e("div",{ref_key:"messagesElDesktop",ref:T,onScroll:P,class:"h-[calc(100%-120px)] overflow-y-auto p-4 flex flex-col"},[d.activeConversation?(o(),s(i,{key:0},[l.value.length===0?(o(),s("div",ke," Hali xabar yo‘q. Birinchi bo‘lib yozing. ")):x("",!0),(o(!0),s(i,null,z(l.value,t=>(o(),s("div",{key:t.id,class:y(["mb-3 flex",t.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:y(["max-w-[70%] rounded-2xl border px-3 py-2 text-sm leading-relaxed",t.sender_id===v.value?"border-gray-200 bg-gray-50 text-gray-900 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100":"border-gray-200 bg-white text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-100"])},[e("div",pe,n(t.sender_id===v.value?"Siz":t.sender_name??"Operator"),1),e("div",_e,n(t.body),1),e("div",we,n(t.created_at),1)],2)],2))),128)),m.value&&Date.now()<M.value?(o(),s("div",Ce,n(m.value)+" yozayapti... ",1)):x("",!0)],64)):(o(),s("div",je," Chat tanlanmagan "))],544),e("div",Se,[e("div",ze,[V(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>c.value=t),onInput:K,disabled:!g.value||f.value,onKeydown:F(O(C,["prevent"]),["enter"]),class:"h-11 flex-1 rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Xabar yozing..."},null,40,qe),[[U,c.value]]),e("button",{class:"h-11 rounded-xl border px-4 text-sm font-semibold border-gray-200 hover:bg-gray-50 disabled:opacity-60 dark:border-gray-800 dark:hover:bg-gray-900",disabled:!I.value,onClick:C}," Send ",8,Me)])])]),S.value?(o(),s("section",Ke,[e("div",Ne,[e("div",Ve,[e("button",{class:"inline-flex items-center justify-center rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-semibold hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:J}," Back "),e("div",Fe,[e("div",Oe,[d.activeConversation?(o(),s(i,{key:0},[b(n(d.activeConversation.channel==="admin"?"Admin bilan chat":"Psixolog bilan chat"),1)],64)):(o(),s(i,{key:1},[b("Chat tanlang")],64))]),e("div",Ue,[d.activeConversation?(o(),s(i,{key:0},[b(n(d.activeConversation.subject??"Mavzu: (yo‘q)"),1)],64)):(o(),s(i,{key:1},[b("Chat tanlanmagan")],64))])])])]),e("div",{ref_key:"messagesElMobile",ref:D,onScroll:P,class:"h-[calc(100%-120px)] overflow-y-auto p-4"},[d.activeConversation?(o(),s(i,{key:0},[l.value.length===0?(o(),s("div",Le," Hali xabar yo‘q. Birinchi bo‘lib yozing. ")):x("",!0),(o(!0),s(i,null,z(l.value,t=>(o(),s("div",{key:t.id,class:y(["mb-3 flex",t.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:y(["max-w-[85%] rounded-2xl border px-3 py-2 text-sm leading-relaxed",t.sender_id===v.value?"border-gray-200 bg-gray-50 text-gray-900 dark:border-gray-800 dark:bg-gray-900 dark:text-gray-100":"border-gray-200 bg-white text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-100"])},[e("div",Xe,n(t.sender_id===v.value?"Siz":t.sender_name??"Operator"),1),e("div",Ye,n(t.body),1),e("div",Ge,n(t.created_at),1)],2)],2))),128)),m.value&&Date.now()<M.value?(o(),s("div",Je,n(m.value)+" yozayapti... ",1)):x("",!0)],64)):(o(),s("div",Re," Chat tanlanmagan "))],544),e("div",We,[e("div",Qe,[V(e("input",{"onUpdate:modelValue":a[5]||(a[5]=t=>c.value=t),onInput:K,disabled:!g.value||f.value,onKeydown:F(O(C,["prevent"]),["enter"]),class:"h-11 flex-1 rounded-xl border border-gray-200 bg-white px-3 text-sm focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60 dark:border-gray-800 dark:bg-gray-950 dark:focus:ring-gray-700",placeholder:"Xabar yozing..."},null,40,Ze),[[U,c.value]]),e("button",{class:"h-11 rounded-xl border px-4 text-sm font-semibold border-gray-200 hover:bg-gray-50 disabled:opacity-60 dark:border-gray-800 dark:hover:bg-gray-900",disabled:!I.value,onClick:C}," Send ",8,et)])])])):(o(),s("aside",Be,[a[8]||(a[8]=e("div",{class:"border-b border-gray-200 px-4 py-3 dark:border-gray-800"},[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"Murojaatlar")],-1)),e("div",Ee,[e("button",{class:"w-full rounded-xl border px-3 py-2 text-xs font-medium border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:a[3]||(a[3]=t=>w("admin"))}," Admin bilan suhbat "),e("button",{class:"w-full rounded-xl border px-3 py-2 text-xs font-medium border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",onClick:a[4]||(a[4]=t=>w("psiholog"))}," Psixolog bilan suhbat ")]),e("div",Te,[(o(!0),s(i,null,z(d.conversations,t=>(o(),s("button",{key:t.id,class:y(["mb-2 w-full rounded-xl border px-3 py-3 text-left transition border-gray-200 hover:bg-gray-50 dark:border-gray-800 dark:hover:bg-gray-900",g.value===t.id?"ring-2 ring-offset-2 ring-gray-300 dark:ring-gray-700 dark:ring-offset-gray-950":""]),onClick:R=>A(t.id)},[e("div",$e,[e("div",Pe,n(t.channel==="admin"?"Admin":"Psixolog"),1),e("span",{class:y(["rounded-full px-2 py-0.5 text-[10px] font-semibold",t.status==="open"?"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200":"bg-gray-100 text-gray-700 dark:bg-gray-900 dark:text-gray-200"])},n(t.status),3)]),e("div",Ae,n(t.subject??"Mavzu: (yo‘q)"),1),e("div",He," Oxirgi: "+n(t.last_message_at??t.created_at),1)],10,De))),128)),d.conversations.length===0?(o(),s("div",Ie," Hali murojaat yo‘q. Yuqoridan suhbat boshlang. ")):x("",!0)])]))])])]),_:1})],64))}});export{ut as default};
